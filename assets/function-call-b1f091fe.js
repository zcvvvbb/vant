import{m as ce,u as re}from"./mount-component-b555bf78.js";import{m as me,c as Q,l as A,H as S,L as ue,q as J,w as ve,o as ge,p as de,d as fe,e as he}from"./use-translate-71d4880c.js";import{u as we}from"./use-expose-80cfd2b2.js";import{I as Pe}from"./index-1ef61aa2.js";import{a as ye,S as Ce}from"./index-c7590142.js";import{P as Ie}from"./index-ddec6e01.js";import{u as Se}from"./use-touch-4e22f945.js";import{I as xe}from"./index-1122429d.js";import{L as be}from"./index-2b75ebd8.js";import{A as ee,H as oe,y as R,D as H,u as p,e as m,M as Te,q as Ye,B as te,Q as pe}from"./vue-libs-19c20d28.js";import{d as k,n as q,t as Z,b as Xe,c as D,u as F,m as U}from"./with-install-560d59bf.js";import{T as V,L as Oe,H as Ze}from"./constant-ee6e27d7.js";import{c as Re}from"./interceptor-5424332a.js";const G=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),ze=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),L=Q("image-preview")[1],K=2.6,He=ee({props:{src:String,show:Boolean,active:Number,minZoom:k(q),maxZoom:k(q),rootWidth:k(Number),rootHeight:k(Number),disableZoom:Boolean,closeOnClickOverlay:Boolean},emits:["scale","close","longPress"],setup(e,{emit:c,slots:u}){const o=oe({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),i=Se(),x=R(),X=R(),P=R(!1),d=R(!1);let y=0;const N=H(()=>{const{scale:t,moveX:a,moveY:s,moving:l,zooming:r,initializing:h}=o,z={transitionDuration:r||l||h?"0s":".3s"};return(t!==1||d.value)&&(z.transform=`matrix(${t}, 0, 0, ${t}, ${a}, ${s})`),z}),v=H(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:a}=e,s=P.value?a/o.imageRatio:t;return Math.max(0,(o.scale*s-t)/2)}return 0}),w=H(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:a}=e,s=P.value?a:t*o.imageRatio;return Math.max(0,(o.scale*s-a)/2)}return 0}),b=(t,a)=>{var s;if(t=S(t,+e.minZoom,+e.maxZoom+1),t!==o.scale){const l=t/o.scale;if(o.scale=t,a){const r=J((s=x.value)==null?void 0:s.$el),h={x:r.width*.5,y:r.height*.5},z=o.moveX-(a.x-r.left-h.x)*(l-1),le=o.moveY-(a.y-r.top-h.y)*(l-1);o.moveX=S(z,-v.value,v.value),o.moveY=S(le,-w.value,w.value)}else o.moveX=0,o.moveY=d.value?y:0;c("scale",{scale:t,index:e.active})}},T=()=>{b(1)},W=()=>{const t=o.scale>1?1:2;b(t,t===2||d.value?{x:i.startX.value,y:i.startY.value}:void 0)};let C,I,n,f,g,E,O,_,$=!1;const ae=t=>{const{touches:a}=t;if(C=a.length,C===2&&e.disableZoom)return;const{offsetX:s}=i;i.start(t),I=o.moveX,n=o.moveY,_=Date.now(),$=!1,o.moving=C===1&&(o.scale!==1||d.value),o.zooming=C===2&&!s.value,o.zooming&&(f=o.scale,g=G(a))},ie=t=>{const{touches:a}=t;if(i.move(t),o.moving){const{deltaX:s,deltaY:l}=i,r=s.value+I,h=l.value+n;if((r>v.value||r<-v.value)&&!$&&i.isHorizontal()){o.moving=!1;return}$=!0,A(t,!0),o.moveX=S(r,-v.value,v.value),o.moveY=S(h,-w.value,w.value)}if(o.zooming&&(A(t,!0),a.length===2)){const s=G(a),l=f*s/g;E=ze(a),b(l,E)}},ne=t=>{var h;if(C>1)return;const{offsetX:a,offsetY:s}=i,l=Date.now()-_,r=250;if(a.value<V&&s.value<V)if(l<r)if(O)clearTimeout(O),O=null,W();else{if(!e.closeOnClickOverlay&&t.target===((h=X.value)==null?void 0:h.$el))return;O=setTimeout(()=>{c("close"),O=null},r)}else l>Oe&&c("longPress")},B=t=>{let a=!1;if((o.moving||o.zooming)&&(a=!0,o.moving&&I===o.moveX&&n===o.moveY&&(a=!1),!t.touches.length)){o.zooming&&(o.moveX=S(o.moveX,-v.value,v.value),o.moveY=S(o.moveY,-w.value,w.value),o.zooming=!1),o.moving=!1,I=0,n=0,f=1,o.scale<1&&T();const s=+e.maxZoom;o.scale>s&&b(s,E)}A(t,a),ne(t),i.reset()},j=()=>{const{rootWidth:t,rootHeight:a}=e,s=a/t,{imageRatio:l}=o;P.value=o.imageRatio>s&&l<K,d.value=o.imageRatio>s&&l>=K,d.value&&(y=(l*t-a)/2,o.moveY=y,o.initializing=!0,ue(()=>{o.initializing=!1})),T()},se=t=>{const{naturalWidth:a,naturalHeight:s}=t.target;o.imageRatio=s/a,j()};return p(()=>e.active,T),p(()=>e.show,t=>{t||T()}),p(()=>[e.rootWidth,e.rootHeight],j),me("touchmove",ie,{target:H(()=>{var t;return(t=X.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>m(be,{type:"spinner"},null)};return m(ye,{ref:X,class:L("swipe-item"),onTouchstartPassive:ae,onTouchend:B,onTouchcancel:B},{default:()=>[u.image?m("div",{class:L("image-wrap")},[u.image({src:e.src})]):m(xe,{ref:x,src:e.src,fit:"contain",class:L("image",{vertical:P.value}),style:N.value,onLoad:se},t)]})}}});function ke(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!pe(e)}const[De,Y]=Q("image-preview"),Me=["show","teleport","transition","overlayStyle","closeOnPopstate"],Ne={show:Boolean,loop:Z,images:Xe(),minZoom:D(1/3),maxZoom:D(3),overlay:Z,closeable:Boolean,showIndex:Z,className:F,closeIcon:U("clear"),transition:String,beforeClose:Function,overlayClass:F,overlayStyle:Object,swipeDuration:D(300),startPosition:D(0),showIndicators:Boolean,closeOnPopstate:Z,closeOnClickOverlay:Z,closeIconPosition:U("top-right"),teleport:[String,Object]},We=ee({name:De,props:Ne,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:c,slots:u}){const o=R(),i=oe({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),x=()=>{if(o.value){const n=J(o.value.$el);i.rootWidth=n.width,i.rootHeight=n.height,o.value.resize()}},X=n=>c("scale",n),P=n=>c("update:show",n),d=()=>{Re(e.beforeClose,{args:[i.active],done:()=>P(!1)})},y=n=>{n!==i.active&&(i.active=n,c("change",n))},N=()=>{if(e.showIndex)return m("div",{class:Y("index")},[u.index?u.index({index:i.active}):`${i.active+1} / ${e.images.length}`])},v=()=>{if(u.cover)return m("div",{class:Y("cover")},[u.cover()])},w=()=>{i.disableZoom=!0},b=()=>{i.disableZoom=!1},T=()=>{let n;return m(Ce,{ref:o,lazyRender:!0,loop:e.loop,class:Y("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:y,onDragEnd:b,onDragStart:w},ke(n=e.images.map((f,g)=>m(He,{src:f,show:e.show,active:i.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,disableZoom:i.disableZoom,closeOnClickOverlay:e.closeOnClickOverlay,onScale:X,onClose:d,onLongPress:()=>c("longPress",{index:g})},{image:u.image})))?n:{default:()=>[n]})},W=()=>{if(e.closeable)return m(Pe,{role:"button",name:e.closeIcon,class:[Y("close-icon",e.closeIconPosition),Ze],onClick:d},null)},C=()=>c("closed"),I=(n,f)=>{var g;return(g=o.value)==null?void 0:g.swipeTo(n,f)};return we({swipeTo:I}),Te(x),p([ve,ge],x),p(()=>e.startPosition,n=>y(+n)),p(()=>e.show,n=>{const{images:f,startPosition:g}=e;n?(y(+g),Ye(()=>{x(),I(+g,{immediate:!0})})):c("close",{index:i.active,url:f[i.active]})}),()=>m(Ie,te({class:[Y(),e.className],overlayClass:[Y("overlay"),e.overlayClass],onClosed:C,"onUpdate:show":P},de(e,Me)),{default:()=>[W(),T(),N(),v()]})}});let M;const Ee={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function $e(){({instance:M}=ce({setup(){const{state:e,toggle:c}=re(),u=()=>{e.images=[]};return()=>m(We,te(e,{onClosed:u,"onUpdate:show":c}),null)}}))}const eo=(e,c=0)=>{if(fe)return M||$e(),e=Array.isArray(e)?{images:e,startPosition:c}:e,M.open(he({},Ee,e)),M};export{We as _,eo as s};
