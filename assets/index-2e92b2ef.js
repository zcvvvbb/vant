import{G as J,m as K,c as O,q as F,l as Q,h as W}from"./use-translate-71d4880c.js";import{u as Z}from"./use-refs-c698ebdb.js";import{u as $}from"./use-touch-4e22f945.js";import{I as G}from"./index-1ef61aa2.js";import{A as ee,y as te,D as P,e as f}from"./vue-libs-19c20d28.js";import{n as X,m as D,c as ae,t as oe,a as le,w as se}from"./with-install-560d59bf.js";const[ne,m]=O("rate");function ie(t,n,s,r){return t>=n?{status:"full",value:1}:t+.5>=n&&s&&!r?{status:"half",value:.5}:t+1>=n&&s&&r?{status:"half",value:Math.round((t-n+1)*1e10)/1e10}:{status:"void",value:0}}const re={size:X,icon:D("star"),color:String,count:ae(5),gutter:X,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:D("star-o"),allowHalf:Boolean,voidColor:String,touchable:oe,iconPrefix:String,modelValue:le(0),disabledColor:String},ue=ee({name:ne,props:re,emits:["change","update:modelValue"],setup(t,{emit:n}){const s=$(),[r,V]=Z(),h=te(),S=P(()=>t.readonly||t.disabled),T=P(()=>S.value||!t.touchable),Y=P(()=>Array(+t.count).fill("").map((a,e)=>ie(t.modelValue,e+1,t.allowHalf,t.readonly)));let l,u,g=Number.MAX_SAFE_INTEGER,b=Number.MIN_SAFE_INTEGER;const I=()=>{u=F(h);const a=r.value.map(F);l=[],a.forEach((e,o)=>{g=Math.min(e.top,g),b=Math.max(e.top,b),t.allowHalf?l.push({score:o+.5,left:e.left,top:e.top,height:e.height},{score:o+1,left:e.left+e.width/2,top:e.top,height:e.height}):l.push({score:o+1,left:e.left,top:e.top,height:e.height})})},y=(a,e)=>{for(let o=l.length-1;o>0;o--)if(e>=u.top&&e<=u.bottom){if(a>l[o].left&&e>=l[o].top&&e<=l[o].top+l[o].height)return l[o].score}else{const c=e<u.top?g:b;if(a>l[o].left&&l[o].top===c)return l[o].score}return t.allowHalf?.5:1},N=a=>{S.value||a===t.modelValue||(n("update:modelValue",a),n("change",a))},q=a=>{T.value||(s.start(a),I())},x=a=>{if(!T.value&&(s.move(a),s.isHorizontal()&&!s.isTap.value)){const{clientX:e,clientY:o}=a.touches[0];Q(a),N(y(e,o))}},L=(a,e)=>{const{icon:o,size:c,color:w,count:C,gutter:E,voidIcon:k,disabled:i,voidColor:z,allowHalf:H,iconPrefix:M,disabledColor:_}=t,v=e+1,R=a.status==="full",d=a.status==="void",U=H&&a.value>0&&a.value<1;let A;E&&v!==+C&&(A={paddingRight:W(E)});const j=B=>{I();let p=H?y(B.clientX,B.clientY):v;t.clearable&&s.isTap.value&&p===t.modelValue&&(p=0),N(p)};return f("div",{key:e,ref:V(e),role:"radio",style:A,class:m("item"),tabindex:i?void 0:0,"aria-setsize":C,"aria-posinset":v,"aria-checked":!d,onClick:j},[f(G,{size:c,name:R?o:k,class:m("icon",{disabled:i,full:R}),color:i?_:R?w:z,classPrefix:M},null),U&&f(G,{size:c,style:{width:a.value+"em"},name:d?k:o,class:m("icon",["half",{disabled:i,full:!d}]),color:i?_:d?z:w,classPrefix:M},null)])};return J(()=>t.modelValue),K("touchmove",x,{target:h}),()=>f("div",{ref:h,role:"radiogroup",class:m({readonly:t.readonly,disabled:t.disabled}),tabindex:t.disabled?void 0:0,"aria-disabled":t.disabled,"aria-readonly":t.readonly,onTouchstartPassive:q},[Y.value.map(L)])}}),ce=se(ue),ve=ce;export{ve as V};
