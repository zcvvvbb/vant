import{c as G,U as me,h as he,q as ee,N as ge,p as q,r as De,V as te,L as Z,M as ye}from"./use-translate-71d4880c.js";import{u as ve}from"./use-refs-c698ebdb.js";import{u as fe}from"./use-expose-80cfd2b2.js";import{P as be}from"./index-ddec6e01.js";import{B as we}from"./index-2ad848b9.js";import{g as ke}from"./utils-8240f58e.js";import{u as Se}from"./use-height-e6919207.js";import{A as J,D as M,e as c,y as $,u as p,B as Te}from"./vue-libs-19c20d28.js";import{d as L,a as xe,n as ne,m as se,t as H,c as Me,w as Re}from"./with-install-560d59bf.js";import{s as ce}from"./function-call-2c179f35.js";const[Ce,d,N]=G("calendar"),Oe=e=>N("monthTitle",e.getFullYear(),e.getMonth()+1);function ae(e,r){const l=e.getFullYear(),m=r.getFullYear();if(l===m){const w=e.getMonth(),x=r.getMonth();return w===x?0:w>x?1:-1}return l>m?1:-1}function R(e,r){const l=ae(e,r);if(l===0){const m=e.getDate(),w=r.getDate();return m===w?0:m>w?1:-1}return l}const _=e=>new Date(e),ue=e=>Array.isArray(e)?e.map(_):_(e);function le(e,r){const l=_(e);return l.setDate(l.getDate()+r),l}const oe=e=>le(e,-1),de=e=>le(e,1),re=()=>{const e=new Date;return e.setHours(0,0,0,0),e};function Pe(e){const r=e[0].getTime();return(e[1].getTime()-r)/(1e3*60*60*24)+1}const[Be]=G("calendar-day"),Ae=J({name:Be,props:{item:L(Object),color:String,index:Number,offset:xe(0),rowHeight:String},emits:["click","clickDisabledDate"],setup(e,{emit:r,slots:l}){const m=M(()=>{var W;const{item:a,index:D,color:k,offset:I,rowHeight:O}=e,S={height:O};if(a.type==="placeholder")return S.width="100%",S;if(D===0&&(S.marginLeft=`${100*I/7}%`),k)switch(a.type){case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":S.background=k;break;case"middle":S.color=k;break}return I+(((W=a.date)==null?void 0:W.getDate())||1)>28&&(S.marginBottom=0),S}),w=()=>{e.item.type!=="disabled"?r("click",e.item):r("clickDisabledDate",e.item)},x=()=>{const{topInfo:a}=e.item;if(a||l["top-info"])return c("div",{class:d("top-info")},[l["top-info"]?l["top-info"](e.item):a])},C=()=>{const{bottomInfo:a}=e.item;if(a||l["bottom-info"])return c("div",{class:d("bottom-info")},[l["bottom-info"]?l["bottom-info"](e.item):a])},b=()=>{const{item:a,color:D,rowHeight:k}=e,{type:I,text:O}=a,S=[x(),O,C()];return I==="selected"?c("div",{class:d("selected-day"),style:{width:k,height:k,background:D}},[S]):S};return()=>{const{type:a,className:D}=e.item;return a==="placeholder"?c("div",{class:d("day"),style:m.value},null):c("div",{role:"gridcell",style:m.value,class:[d("day",a),D],tabindex:a==="disabled"?void 0:-1,onClick:w},[b()])}}}),[He]=G("calendar-month"),Ie={date:L(Date),type:String,color:String,minDate:L(Date),maxDate:L(Date),showMark:Boolean,rowHeight:ne,formatter:Function,lazyRender:Boolean,currentDate:[Date,Array],allowSameDay:Boolean,showSubtitle:Boolean,showMonthTitle:Boolean,firstDayOfWeek:Number},Ne=J({name:He,props:Ie,emits:["click","clickDisabledDate"],setup(e,{emit:r,slots:l}){const[m,w]=me(),x=$(),C=$(),b=Se(C),a=M(()=>Oe(e.date)),D=M(()=>he(e.rowHeight)),k=M(()=>{const o=e.date.getDay();return e.firstDayOfWeek?(o+7-e.firstDayOfWeek)%7:o}),I=M(()=>ke(e.date.getFullYear(),e.date.getMonth()+1)),O=M(()=>m.value||!e.lazyRender),S=()=>a.value,W=o=>{const h=u=>e.currentDate.some(f=>R(f,u)===0);if(h(o)){const u=oe(o),f=de(o),y=h(u),t=h(f);return y&&t?"multiple-middle":y?"end":t?"start":"multiple-selected"}return""},F=o=>{const[h,u]=e.currentDate;if(!h)return"";const f=R(o,h);if(!u)return f===0?"start":"";const y=R(o,u);return e.allowSameDay&&f===0&&y===0?"start-end":f===0?"start":y===0?"end":f>0&&y<0?"middle":""},z=o=>{const{type:h,minDate:u,maxDate:f,currentDate:y}=e;if(R(o,u)<0||R(o,f)>0)return"disabled";if(y===null)return"";if(Array.isArray(y)){if(h==="multiple")return W(o);if(h==="range")return F(o)}else if(h==="single")return R(o,y)===0?"selected":"";return""},V=o=>{if(e.type==="range"){if(o==="start"||o==="end")return N(o);if(o==="start-end")return`${N("start")}/${N("end")}`}},E=()=>{if(e.showMonthTitle)return c("div",{class:d("month-title")},[l["month-title"]?l["month-title"]({date:e.date,text:a.value}):a.value])},U=()=>{if(e.showMark&&O.value)return c("div",{class:d("month-mark")},[e.date.getMonth()+1])},j=M(()=>{const o=Math.ceil((I.value+k.value)/7);return Array(o).fill({type:"placeholder"})}),Y=M(()=>{const o=[],h=e.date.getFullYear(),u=e.date.getMonth();for(let f=1;f<=I.value;f++){const y=new Date(h,u,f),t=z(y);let n={date:y,type:t,text:f,bottomInfo:V(t)};e.formatter&&(n=e.formatter(n)),o.push(n)}return o}),P=M(()=>Y.value.filter(o=>o.type==="disabled")),K=(o,h)=>{if(x.value){const u=ee(x.value),f=j.value.length,t=(Math.ceil((h.getDate()+k.value)/7)-1)*u.height/f;ge(o,u.top+t+o.scrollTop-ee(o).top)}},Q=(o,h)=>c(Ae,{item:o,index:h,color:e.color,offset:k.value,rowHeight:D.value,onClick:u=>r("click",u),onClickDisabledDate:u=>r("clickDisabledDate",u)},q(l,["top-info","bottom-info"])),X=()=>c("div",{ref:x,role:"grid",class:d("days")},[U(),(O.value?Y:j).value.map(Q)]);return fe({getTitle:S,getHeight:()=>b.value,setVisible:w,scrollToDate:K,disabledDays:P}),()=>c("div",{class:d("month"),ref:C},[E(),X()])}}),[We]=G("calendar-header"),Fe=J({name:We,props:{date:Date,title:String,subtitle:String,showTitle:Boolean,showSubtitle:Boolean,firstDayOfWeek:Number},emits:["clickSubtitle"],setup(e,{slots:r,emit:l}){const m=()=>{if(e.showTitle){const b=e.title||N("title"),a=r.title?r.title():b;return c("div",{class:d("header-title")},[a])}},w=b=>l("clickSubtitle",b),x=()=>{if(e.showSubtitle){const b=r.subtitle?r.subtitle({date:e.date,text:e.subtitle}):e.subtitle;return c("div",{class:d("header-subtitle"),onClick:w},[b])}},C=()=>{const{firstDayOfWeek:b}=e,a=N("weekdays"),D=[...a.slice(b,7),...a.slice(0,b)];return c("div",{class:d("weekdays")},[D.map(k=>c("span",{class:d("weekday")},[k]))])};return()=>c("div",{class:d("header")},[m(),x(),C()])}}),Ve={show:Boolean,type:se("single"),title:String,color:String,round:H,readonly:Boolean,poppable:H,maxRange:Me(null),position:se("bottom"),teleport:[String,Object],showMark:H,showTitle:H,formatter:Function,rowHeight:ne,confirmText:String,rangePrompt:String,lazyRender:H,showConfirm:H,defaultDate:[Date,Array],allowSameDay:Boolean,showSubtitle:H,closeOnPopstate:H,showRangePrompt:H,confirmDisabledText:String,closeOnClickOverlay:H,safeAreaInsetTop:Boolean,safeAreaInsetBottom:H,minDate:{type:Date,validator:te,default:re},maxDate:{type:Date,validator:te,default:()=>{const e=re();return new Date(e.getFullYear(),e.getMonth()+6,e.getDate())}},firstDayOfWeek:{type:ne,default:0,validator:e=>e>=0&&e<=6}},Ye=J({name:Ce,props:Ve,emits:["select","confirm","unselect","monthShow","overRange","update:show","clickSubtitle","clickDisabledDate"],setup(e,{emit:r,slots:l}){const m=(t,n=e.minDate,i=e.maxDate)=>R(t,n)===-1?n:R(t,i)===1?i:t,w=(t=e.defaultDate)=>{const{type:n,minDate:i,maxDate:s,allowSameDay:T}=e;if(t===null)return t;const v=re();if(n==="range"){Array.isArray(t)||(t=[]);const B=m(t[0]||v,i,T?s:oe(s)),g=m(t[1]||v,T?i:de(i));return[B,g]}return n==="multiple"?Array.isArray(t)?t.map(B=>m(B)):[m(v)]:((!t||Array.isArray(t))&&(t=v),m(t))};let x;const C=$(),b=$({text:"",date:void 0}),a=$(w()),[D,k]=ve(),I=M(()=>e.firstDayOfWeek?+e.firstDayOfWeek%7:0),O=M(()=>{const t=[],n=new Date(e.minDate);n.setDate(1);do t.push(new Date(n)),n.setMonth(n.getMonth()+1);while(ae(n,e.maxDate)!==1);return t}),S=M(()=>{if(a.value){if(e.type==="range")return!a.value[0]||!a.value[1];if(e.type==="multiple")return!a.value.length}return!a.value}),W=()=>a.value,F=()=>{const t=ye(C.value),n=t+x,i=O.value.map((g,A)=>D.value[A].getHeight()),s=i.reduce((g,A)=>g+A,0);if(n>s&&t>0)return;let T=0,v;const B=[-1,-1];for(let g=0;g<O.value.length;g++){const A=D.value[g];T<=n&&T+i[g]>=t&&(B[1]=g,v||(v=A,B[0]=g),D.value[g].showed||(D.value[g].showed=!0,r("monthShow",{date:A.date,title:A.getTitle()}))),T+=i[g]}O.value.forEach((g,A)=>{const ie=A>=B[0]-1&&A<=B[1]+1;D.value[A].setVisible(ie)}),v&&(b.value={text:v.getTitle(),date:v.date})},z=t=>{Z(()=>{O.value.some((n,i)=>ae(n,t)===0?(C.value&&D.value[i].scrollToDate(C.value,t),!0):!1),F()})},V=()=>{if(!(e.poppable&&!e.show))if(a.value){const t=e.type==="single"?a.value:a.value[0];te(t)&&z(t)}else Z(F)},E=()=>{e.poppable&&!e.show||(Z(()=>{x=Math.floor(ee(C).height)}),V())},U=(t=w())=>{a.value=t,V()},j=t=>{const{maxRange:n,rangePrompt:i,showRangePrompt:s}=e;return n&&Pe(t)>+n?(s&&ce(i||N("rangePrompt",n)),r("overRange"),!1):!0},Y=()=>r("confirm",a.value??ue(a.value)),P=(t,n)=>{const i=s=>{a.value=s,r("select",ue(s))};if(n&&e.type==="range"&&!j(t)){i([t[0],le(t[0],+e.maxRange-1)]);return}i(t),n&&!e.showConfirm&&Y()},K=(t,n,i)=>{var s;return(s=t.find(T=>R(n,T.date)===-1&&R(T.date,i)===-1))==null?void 0:s.date},Q=M(()=>D.value.reduce((t,n)=>{var i;return t.push(...((i=n.disabledDays)==null?void 0:i.value)??[]),t},[])),X=t=>{if(e.readonly||!t.date)return;const{date:n}=t,{type:i}=e;if(i==="range"){if(!a.value){P([n]);return}const[s,T]=a.value;if(s&&!T){const v=R(n,s);if(v===1){const B=K(Q.value,s,n);if(B){const g=oe(B);R(s,g)===-1?P([s,g]):P([n])}else P([s,n],!0)}else v===-1?P([n]):e.allowSameDay&&P([n,n],!0)}else P([n])}else if(i==="multiple"){if(!a.value){P([n]);return}const s=a.value,T=s.findIndex(v=>R(v,n)===0);if(T!==-1){const[v]=s.splice(T,1);r("unselect",_(v))}else e.maxRange&&s.length>=+e.maxRange?ce(e.rangePrompt||N("rangePrompt",e.maxRange)):P([...s,n])}else P(n,!0)},o=t=>r("update:show",t),h=(t,n)=>{const i=n!==0||!e.showSubtitle;return c(Ne,Te({ref:k(n),date:t,currentDate:a.value,showMonthTitle:i,firstDayOfWeek:I.value},q(e,["type","color","minDate","maxDate","showMark","formatter","rowHeight","lazyRender","showSubtitle","allowSameDay"]),{onClick:X,onClickDisabledDate:s=>r("clickDisabledDate",s)}),q(l,["top-info","bottom-info","month-title"]))},u=()=>{if(l.footer)return l.footer();if(e.showConfirm){const t=l["confirm-text"],n=S.value,i=n?e.confirmDisabledText:e.confirmText;return c(we,{round:!0,block:!0,type:"primary",color:e.color,class:d("confirm"),disabled:n,nativeType:"button",onClick:Y},{default:()=>[t?t({disabled:n}):i||N("confirm")]})}},f=()=>c("div",{class:[d("footer"),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[u()]),y=()=>c("div",{class:d()},[c(Fe,{date:b.value.date,title:e.title,subtitle:b.value.text,showTitle:e.showTitle,showSubtitle:e.showSubtitle,firstDayOfWeek:I.value,onClickSubtitle:t=>r("clickSubtitle",t)},q(l,["title","subtitle"])),c("div",{ref:C,class:d("body"),onScroll:F},[O.value.map(h)]),f()]);return p(()=>e.show,E),p(()=>[e.type,e.minDate,e.maxDate],()=>U(w(a.value))),p(()=>e.defaultDate,(t=null)=>{a.value=t,V()}),fe({reset:U,scrollToDate:z,getSelectedDate:W}),De(E),()=>e.poppable?c(be,{show:e.show,class:d("popup"),round:e.round,position:e.position,closeable:e.showTitle||e.showSubtitle,teleport:e.teleport,closeOnPopstate:e.closeOnPopstate,safeAreaInsetTop:e.safeAreaInsetTop,closeOnClickOverlay:e.closeOnClickOverlay,"onUpdate:show":o},{default:y}):y()}}),$e=Re(Ye),Qe=$e;export{Qe as V};
